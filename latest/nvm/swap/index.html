<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Swap · ML-Tools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ML-Tools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Launcher</span><ul><li><a class="toctext" href="../../launcher/launcher/">Tutorial</a></li><li><a class="toctext" href="../../launcher/docstrings/">Docstrings</a></li></ul></li><li><span class="toctext">Workloads</span><ul><li><a class="toctext" href="../../workloads/tf_benchmarks/">Tensorflow Benchmarks</a></li><li><a class="toctext" href="../../workloads/ngraph/">NGraph Models</a></li><li><a class="toctext" href="../../workloads/cifarcnn/">Cifar Cnn</a></li><li><a class="toctext" href="../../workloads/test/">Test Workload</a></li></ul></li><li><span class="toctext">Datasets</span><ul><li><a class="toctext" href="../../datasets/imagenet/">Imagenet</a></li><li><a class="toctext" href="../../datasets/rnn/">RNN Translator</a></li><li><a class="toctext" href="../../datasets/brats/">BraTS</a></li></ul></li><li><a class="toctext" href="../../manifest/">Manifest</a></li><li><span class="toctext">NVM</span><ul><li class="current"><a class="toctext" href>Swap</a><ul class="internal"><li><a class="toctext" href="#Partitioning-the-Drive-1">Partitioning the Drive</a></li><li><a class="toctext" href="#Creating-a-file-system-and-mounting-1">Creating a file system and mounting</a></li><li><a class="toctext" href="#Configuring-Swap-1">Configuring Swap</a></li><li><a class="toctext" href="#Removing-Swap-1">Removing Swap</a></li></ul></li></ul></li><li><span class="toctext">Misc</span><ul><li><a class="toctext" href="../../extra/perf/">PAPI Notes</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>NVM</li><li><a href>Swap</a></li></ul><a class="edit-page" href="https://github.com/darchr/ml-tools/blob/master/docs/src/nvm/swap.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Swap</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Swap-1" href="#Swap-1">Swap</a></h1><p>For some timing experiments, we reduce the amount of DRAM available to the docker container, and instead allow it to use swap on an Optane drive. This is initially for exploration of how decreasing memory affects performace of CPU training. Below is outlined the process of setting up and removing swap partitions.</p><h2><a class="nav-anchor" id="Partitioning-the-Drive-1" href="#Partitioning-the-Drive-1">Partitioning the Drive</a></h2><p>First, I created a partition on the NVM drive with</p><pre><code class="language-sh">sudo fdisk /dev/nvme0n1</code></pre><p>Then proceeded with the options: </p><ul><li><code>n</code> (new partition) </li><li><code>p</code> (primary partiton)</li><li><code>1</code> (partition number)</li><li>Default sectors</li><li><code>w</code> (write this information to disk)</li></ul><p>The output of <code>fdisk</code> looked like below</p><pre><code class="language-none">Welcome to fdisk (util-linux 2.31.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.
Created a new DOS disklabel with disk identifier 0xe142f7ae.

Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-1875385007, default 2048):
Last sector, +sectors or +size{K,M,G,T,P} (2048-1875385007, default 1875385007):

Created a new partition 1 of type &#39;Linux&#39; and of size 894.3 GiB.

Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.</code></pre><p>Running <code>lsblk</code> revealed the following now for the NVM drive</p><pre><code class="language-none">nvme0n1     259:0    0 894.3G  0 disk
└─nvme0n1p1 259:2    0 894.3G  0 part</code></pre><h2><a class="nav-anchor" id="Creating-a-file-system-and-mounting-1" href="#Creating-a-file-system-and-mounting-1">Creating a file system and mounting</a></h2><p>Then, I created a file system on the drive with</p><pre><code class="language-sh">sudo mkfs -t ext4 /dev/nvme0n1p1</code></pre><p>I created a directory and mounted the drive:</p><pre><code class="language-sh">sudo mkdir /mnt/nvme
sudo mount /dev/nvme0n1p1 /mnt/nvme</code></pre><h2><a class="nav-anchor" id="Configuring-Swap-1" href="#Configuring-Swap-1">Configuring Swap</a></h2><pre><code class="language-sh">sudo fallocate -l 32g /mnt/nvme/32gb.swap
sudo chmod 0600 /mnt/nvme/32gb.swap
sudo mkswap /mnt/nvme/32gb.swap
sudo swapon -p 0 /mnt/nvme/32gb.swap</code></pre><p>Verify that the file is being used as swap using</p><pre><code class="language-sh">swapon -s</code></pre><h2><a class="nav-anchor" id="Removing-Swap-1" href="#Removing-Swap-1">Removing Swap</a></h2><p>To remove the swapfile from system swap, just use</p><pre><code class="language-sh">sudo swapoff /mnt/nvme/32gb.swap</code></pre><footer><hr/><a class="previous" href="../../manifest/"><span class="direction">Previous</span><span class="title">Manifest</span></a><a class="next" href="../../extra/perf/"><span class="direction">Next</span><span class="title">PAPI Notes</span></a></footer></article></body></html>
