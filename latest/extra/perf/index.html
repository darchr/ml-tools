<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>PAPI Notes · ML-Tools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ML-Tools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../manifest/">Manifest</a></li><li><a class="toctext" href="../../notebooks/">Notebooks</a></li><li><span class="toctext">Docker</span><ul><li><a class="toctext" href="../../docker/docker/">Docker</a></li><li><a class="toctext" href="../../docker/tensorflow/">Tensorflow CPU</a></li></ul></li><li><span class="toctext">Datasets</span><ul><li><a class="toctext" href="../../datasets/imagenet/">Imagenet</a></li></ul></li><li><span class="toctext">Workloads</span><ul><li><a class="toctext" href="../../workloads/ubuntu/">Ubuntu Workloads</a></li><li><a class="toctext" href="../../workloads/tensorflow/">Tensorflow Models</a></li><li><a class="toctext" href="../../workloads/slim/">Slim</a></li><li><a class="toctext" href="../../workloads/keras/">Keras Models</a></li></ul></li><li><span class="toctext">Launcher</span><ul><li><a class="toctext" href="../../launcher/">Launcher</a></li></ul></li><li><span class="toctext">NVM</span><ul><li><a class="toctext" href="../../nvm/swap/">Swap</a></li></ul></li><li><span class="toctext">Misc</span><ul><li class="current"><a class="toctext" href>PAPI Notes</a><ul class="internal"><li><a class="toctext" href="#Finding-Perf-Codes-1">Finding Perf Codes</a></li></ul></li></ul></li><li><a class="toctext" href="../../deprecated/">Deprecated Workloads</a></li></ul></nav><article id="docs"><header><nav><ul><li>Misc</li><li><a href>PAPI Notes</a></li></ul><a class="edit-page" href="https://github.com/darchr/ml-tools/blob/master/docs/src/extra/perf.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>PAPI Notes</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="PAPI-Notes-1" href="#PAPI-Notes-1">PAPI Notes</a></h1><p>The following issues about PAPI are either known or were discovered:</p><ul><li><p>Some hardware performance counters such as single precision and double precision floating   point instruction counters do not seem to work on AMD EPYC processors:   <a href="https://bitbucket.org/icl/papi/issues/56/dp-and-sp-validation-tests-on-amd">https://bitbucket.org/icl/papi/issues/56/dp-and-sp-validation-tests-on-amd</a></p></li><li><p>PAPI version <code>stable-5.6.0</code>: Function <code>PAPI_read</code> (and related functions that read from   event counters) trigger an integer divide by zero exception on the AMD EPYC system I    tried, rendering this version unusable. It&#39;s possible that this would work on Intel    hardware, but I haven&#39;t tried.</p></li><li><p>PAPI master <code>0fdac4fc7f95f0ac8039e431419a5133088911af</code>: Reads from hardware counters    monitoring L1 cache loads and stores (as well as loads and stores for other levels   in the memory hierarchy) return negative numbers both consistently and sporadically on    Intel systems. The hardware counters I believe are 48-bits, thus we should not be seeing   any counter overflow. I&#39;m calling this a bug.</p></li><li><p>PAPI version <code>stable-5.5.0</code>: No hardware events are recognized on the Intel system.    I think this may be due to <code>libpfm</code> being an older version.</p></li><li><p>The version of PAPI that works for me and seems to return consistent and reasonable results   across trials is <code>stable-5.5.1</code>. However, this version is old and I have concerns that   it may be lacking support for newer generations of processors (i.e. Cascade Lake)    </p></li></ul><p><strong>Final Solution</strong>: After playing around with <code>git bisesct</code>, I discovered that the integer division bug cropped up when reading of performance counters via the <code>rdpmc</code> instruction was switched to the default (sometime after the 5.5.1 release). The <code>rdpmc</code> instruction is a x86 instruction for reading quickly from the performance counters. It seems that the PAPI implementation of using this instruction is quite buggy. By compiling PAPI with <code>rdpmc</code> turned off:</p><pre><code class="language-none">./configure --enable-perfevent-rdpmc=no</code></pre><p>I was once again getting consistent and sensible numbers. Thus, I finally ended up using the master released, but disabling <code>rdpmc</code>.</p><h2><a class="nav-anchor" id="Finding-Perf-Codes-1" href="#Finding-Perf-Codes-1">Finding Perf Codes</a></h2><p>A VERY helpful resource for finding event codes and such:  <a href="http://www.bnikolic.co.uk/blog/hpc-prof-events.html">http://www.bnikolic.co.uk/blog/hpc-prof-events.html</a>.</p><footer><hr/><a class="previous" href="../../nvm/swap/"><span class="direction">Previous</span><span class="title">Swap</span></a><a class="next" href="../../deprecated/"><span class="direction">Next</span><span class="title">Deprecated Workloads</span></a></footer></article></body></html>
