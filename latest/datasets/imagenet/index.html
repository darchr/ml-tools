<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Imagenet · ML-Tools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ML-Tools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../manifest/">Manifest</a></li><li><a class="toctext" href="../../notebooks/">Notebooks</a></li><li><span class="toctext">Docker</span><ul><li><a class="toctext" href="../../docker/docker/">Docker</a></li><li><a class="toctext" href="../../docker/tensorflow/">Tensorflow CPU</a></li></ul></li><li><span class="toctext">Datasets</span><ul><li class="current"><a class="toctext" href>Imagenet</a><ul class="internal"><li><a class="toctext" href="#Getting-the-Datasets-1">Getting the Datasets</a></li><li><a class="toctext" href="#Using-Imagenet-in-Tensorflow-1">Using Imagenet in Tensorflow</a></li></ul></li><li><a class="toctext" href="../slim/">Tensorflow Slim</a></li></ul></li><li><span class="toctext">Workloads</span><ul><li><a class="toctext" href="../../workloads/ubuntu/">Ubuntu Workloads</a></li><li><a class="toctext" href="../../workloads/tensorflow/">Tensorflow Models</a></li><li><a class="toctext" href="../../workloads/slim/">Slim</a></li><li><a class="toctext" href="../../workloads/keras/">Keras Models</a></li></ul></li><li><span class="toctext">Launcher</span><ul><li><a class="toctext" href="../../launcher/">Launcher</a></li></ul></li><li><span class="toctext">NVM</span><ul><li><a class="toctext" href="../../nvm/swap/">Swap</a></li></ul></li><li><span class="toctext">Misc</span><ul><li><a class="toctext" href="../../extra/perf/">PAPI Notes</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Datasets</li><li><a href>Imagenet</a></li></ul><a class="edit-page" href="https://github.com/darchr/ml-tools/blob/master/docs/src/datasets/imagenet.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Imagenet</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Imagenet-1" href="#Imagenet-1">Imagenet</a></h1><h2><a class="nav-anchor" id="Getting-the-Datasets-1" href="#Getting-the-Datasets-1">Getting the Datasets</a></h2><p>Theoretically, you can download the original 2012 Imagenet images from  <a href="http://image-net.org/download-images">http://image-net.org/download-images</a> by first registering. However, when I tried that, I never received an email confirming my registration and thus allowing me to download. I had to resort to ... other means.</p><p>In the process of searching for where to download, I came across some comments that the  Imagenet2012 database had moved to a new home. However, when writing up this documentation, I couldn&#39;t find that reference nor the new home.</p><p>In conclusion, it seems that getting the dataset is significantly less straightforward than it should be. However, it is possible to find the dataset eventually.</p><h2><a class="nav-anchor" id="Using-Imagenet-in-Tensorflow-1" href="#Using-Imagenet-in-Tensorflow-1">Using Imagenet in Tensorflow</a></h2><p>The training and validation .tar files need to be converted into something called a  <code>TFRecord</code> format (something used by Tensorflow I guess). This flow assumes that you have the datasets downloaded and stored in a path <code>/path-to-datasets/</code>. Some helpful links are provided:</p><ul><li><p>Documentation on how to get the official ResNet tensorflow models working on the   Image net data: <a href="https://github.com/tensorflow/models/tree/master/official/resnet">https://github.com/tensorflow/models/tree/master/official/resnet</a></p></li><li><p>Documentation and script for converting the Imagenet .tar files into the form desired   by Tensorflow: <a href="https://github.com/tensorflow/tpu/tree/master/tools/datasets#imagenet_to_gcspy">https://github.com/tensorflow/tpu/tree/master/tools/datasets#imagenet_to_gcspy</a></p></li><li><p>The Python script that does the conversion: <a href="https://github.com/tensorflow/tpu/blob/master/tools/datasets/imagenet_to_gcs.py">https://github.com/tensorflow/tpu/blob/master/tools/datasets/imagenet_to_gcs.py</a></p></li></ul><p>This info should all be incorporated into the build script <code>build.sh</code>. To run it, just  execute</p><pre><code class="language-sh">./build.sh /path-to-tar-files</code></pre><p>This will create the folders</p><pre><code class="language-none">/path-to-tar-files/train
/path-to-tar-files/validation</code></pre><p>and unpack the tar files into these respective folders. The original tar files will be left alone, so make sure you have around 300G of extra free space when you do this, otherwise  you&#39;re gonna have a bad day.</p><p>After unpacking, the build script will execute the <code>imagenet_to_gcs.py</code> script to do the actual conversion.</p><p>Be aware that dataset conversion can take a long time. You probably want to run the build script in a <code>tmux</code> shell or something so you can go have a coffee.</p><p>Note that the build script will launch an docker instance of <code>darchr/tf-compiled-base</code>  because the Python script needs Tensorflow to run. Once the script finishes, you should be good to go.</p><h3><a class="nav-anchor" id="Changes-made-to-imagenet_to_gcs.py-1" href="#Changes-made-to-imagenet_to_gcs.py-1">Changes made to <code>imagenet_to_gcs.py</code></a></h3><p>I had to make several changes for Python 2 to Python 3 compatibility. (Seriously folks,  can&#39;t we all just agree to use Python 3??)</p><ul><li><p>Line 58: Commented out the <code>import google.cloud ...</code> line because we&#39;re not uploading    anything to the google cloud and I don&#39;t want to install that package.</p></li><li><p>Lines 177, 179: Suffixed string literals with <code>&#39;&#39;.encode()</code> to tell python that these    should by byte collections.</p></li><li><p>Lines 187, 189: Add <code>.encode</code> to several strings to <code>_bytes_feature</code> doesn&#39;t complain.</p></li><li><p>Line 282: Change the &#39;r&#39; option in reading to &#39;rb&#39;. Avoid trying to reinterpret image   data as <code>utf-8</code>, which will definitely not work.</p></li><li><p>Line 370: A Python <code>range</code> object is used and then shuffled. However, in Python3, ranges   have become lazy and thus cannot be shuffled. I changed this by explicitly converting   the <code>range</code> to a <code>list</code>, forcing materialization of the whole range.</p></li></ul><footer><hr/><a class="previous" href="../../docker/tensorflow/"><span class="direction">Previous</span><span class="title">Tensorflow CPU</span></a><a class="next" href="../slim/"><span class="direction">Next</span><span class="title">Tensorflow Slim</span></a></footer></article></body></html>
