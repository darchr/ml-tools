<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Imagenet · ML-Tools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ML-Tools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../manifest/">Manifest</a></li><li><a class="toctext" href="../../notebooks/">Notebooks</a></li><li><span class="toctext">Docker</span><ul><li><a class="toctext" href="../../docker/docker/">Docker</a></li><li><a class="toctext" href="../../docker/tensorflow/">Tensorflow CPU</a></li></ul></li><li><span class="toctext">Datasets</span><ul><li class="current"><a class="toctext" href>Imagenet</a><ul class="internal"><li><a class="toctext" href="#Getting-the-Datasets-1">Getting the Datasets</a></li><li><a class="toctext" href="#Imagenet-for-Tensorflow-Official-Models-1">Imagenet for Tensorflow Official Models</a></li><li><a class="toctext" href="#Tensorflow-for-Slim-Models-1">Tensorflow for Slim Models</a></li></ul></li><li><a class="toctext" href="../fsns/">French Street Name Signs (FSNS)</a></li></ul></li><li><span class="toctext">Workloads</span><ul><li><a class="toctext" href="../../workloads/ubuntu/">Ubuntu Workloads</a></li><li><a class="toctext" href="../../workloads/tensorflow/">Tensorflow Models</a></li><li><a class="toctext" href="../../workloads/slim/">Slim</a></li><li><a class="toctext" href="../../workloads/keras/">Keras Models</a></li></ul></li><li><span class="toctext">Launcher</span><ul><li><a class="toctext" href="../../launcher/">Launcher</a></li></ul></li><li><span class="toctext">NVM</span><ul><li><a class="toctext" href="../../nvm/swap/">Swap</a></li></ul></li><li><span class="toctext">Misc</span><ul><li><a class="toctext" href="../../extra/perf/">PAPI Notes</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Datasets</li><li><a href>Imagenet</a></li></ul><a class="edit-page" href="https://github.com/darchr/ml-tools/blob/master/docs/src/datasets/imagenet.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Imagenet</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Imagenet-1" href="#Imagenet-1">Imagenet</a></h1><h2><a class="nav-anchor" id="Getting-the-Datasets-1" href="#Getting-the-Datasets-1">Getting the Datasets</a></h2><p>Theoretically, you can download the original 2012 Imagenet images from  <a href="http://image-net.org/download-images">http://image-net.org/download-images</a> by first registering. However, when I tried that, I never received an email confirming my registration and thus allowing me to download. I had to resort to ... other means.</p><p>In the process of searching for where to download, I came across some comments that the  Imagenet2012 database had moved to a new home. However, when writing up this documentation, I couldn&#39;t find that reference nor the new home.</p><p>In conclusion, it seems that getting the dataset is significantly less straightforward than it should be. However, it is possible to find the dataset eventually. I think the dataset has officially been mirrored on Kaggle:  <a href="https://www.kaggle.com/c/imagenet-object-localization-challenge/data">https://www.kaggle.com/c/imagenet-object-localization-challenge/data</a></p><h2><a class="nav-anchor" id="Imagenet-for-Tensorflow-Official-Models-1" href="#Imagenet-for-Tensorflow-Official-Models-1">Imagenet for Tensorflow Official Models</a></h2><p>The training and validation .tar files need to be converted into something called a  <code>TFRecord</code> format (something used by Tensorflow I guess). This flow assumes that you have the datasets downloaded and stored in a path <code>/path-to-datasets/</code>. Some helpful links are provided:</p><ul><li><p>Documentation on how to get the official ResNet tensorflow models working on the   Image net data: <a href="https://github.com/tensorflow/models/tree/master/official/resnet">https://github.com/tensorflow/models/tree/master/official/resnet</a></p></li><li><p>Documentation and script for converting the Imagenet .tar files into the form desired   by Tensorflow: <a href="https://github.com/tensorflow/tpu/tree/master/tools/datasets#imagenet_to_gcspy">https://github.com/tensorflow/tpu/tree/master/tools/datasets#imagenet_to_gcspy</a></p></li><li><p>The Python script that does the conversion: <a href="https://github.com/tensorflow/tpu/blob/master/tools/datasets/imagenet_to_gcs.py">https://github.com/tensorflow/tpu/blob/master/tools/datasets/imagenet_to_gcs.py</a></p></li></ul><p>This info should all be incorporated into the build script <code>build.sh</code>. To run it, just  execute</p><pre><code class="language-sh">./build.sh /path-to-tar-files</code></pre><p>This will create the folders</p><pre><code class="language-none">/path-to-tar-files/train
/path-to-tar-files/validation</code></pre><p>and unpack the tar files into these respective folders. The original tar files will be left alone, so make sure you have around 300G of extra free space when you do this, otherwise  you&#39;re gonna have a bad day.</p><p>After unpacking, the build script will execute the <code>imagenet_to_gcs.py</code> script to do the actual conversion.</p><p>Be aware that dataset conversion can take a long time. You probably want to run the build script in a <code>tmux</code> shell or something so you can go have a coffee.</p><p>Note that the build script will launch an docker instance of <code>darchr/tf-compiled-base</code>  because the Python script needs Tensorflow to run. Once the script finishes, you should be good to go.</p><h3><a class="nav-anchor" id="Changes-made-to-imagenet_to_gcs.py-1" href="#Changes-made-to-imagenet_to_gcs.py-1">Changes made to <code>imagenet_to_gcs.py</code></a></h3><p>I had to make several changes for Python 2 to Python 3 compatibility. (Seriously folks,  can&#39;t we all just agree to use Python 3??)</p><ul><li><p>Line 58: Commented out the <code>import google.cloud ...</code> line because we&#39;re not uploading    anything to the google cloud and I don&#39;t want to install that package.</p></li><li><p>Lines 177, 179: Suffixed string literals with <code>&#39;&#39;.encode()</code> to tell python that these    should by byte collections.</p></li><li><p>Lines 187, 189: Add <code>.encode</code> to several strings to <code>_bytes_feature</code> doesn&#39;t complain.</p></li><li><p>Line 282: Change the &#39;r&#39; option in reading to &#39;rb&#39;. Avoid trying to reinterpret image   data as <code>utf-8</code>, which will definitely not work.</p></li><li><p>Line 370: A Python <code>range</code> object is used and then shuffled. However, in Python3, ranges   have become lazy and thus cannot be shuffled. I changed this by explicitly converting   the <code>range</code> to a <code>list</code>, forcing materialization of the whole range.</p></li></ul><h2><a class="nav-anchor" id="Tensorflow-for-Slim-Models-1" href="#Tensorflow-for-Slim-Models-1">Tensorflow for Slim Models</a></h2><h3><a class="nav-anchor" id="Preparation-steps-(don&#39;t-need-to-repeat)-1" href="#Preparation-steps-(don&#39;t-need-to-repeat)-1">Preparation steps (don&#39;t need to repeat)</a></h3><p>The code in this repo is taken from the build process that comes in the <code>slim</code> project. However, I&#39;ve modified it so it works without having to go through Bazel (I don&#39;t really know why that was used in the first place) and also updated it so it works with Python3.</p><p><strong>Changes made to build</strong></p><ul><li><p><code>download_and_convert_imagenet.sh</code></p><ul><li><p>Removed some build comments that are no longer relevant.</p></li><li><p>Line 59: Change path for <code>WORK_DIR</code> since we&#39;re no longer doing the Bazel style   build.</p></li><li><p>Line 104: Change path to <code>build_iamgenet_data.py</code>.</p></li><li><p>Line 108: Put <code>python3</code> in front of script invocation. Get around executable   permission errors.</p></li></ul></li><li><p><code>datasets/build_imagenet_data.py</code></p><ul><li><p>Lines 213, 216, 217, and 224: Suffix <code>.encode()</code> on string arguments to pass them   as bytes to <code>_bytes_feature</code>.</p></li><li><p>Lines 527: Wrap <code>range(len(filenames))</code> in <code>list()</code> to materialize the lazy range   type.</p></li></ul></li><li><p><code>datasets/download_imagenet.sh</code></p><ul><li>Lines 72 and 81: Comment out <code>wget</code> commands, avoid downloading imagenet training   and validation data.</li></ul></li><li><p><code>datasets/preprocess_imagenet_validation_data.py</code></p><ul><li><p>Line 1: <code>#!/usr/bin/python</code> -&gt; <code>#!/usr/bin/python3</code></p></li><li><p>Remove importing of <code>six.moves</code> module.</p></li><li><p>Change all instances of <code>xrange</code> to <code>range</code>. The <code>range</code> type in python3 behaves   just like the xrange type.</p></li></ul></li><li><p><code>datasets/process_bounding_boxes.py</code></p><ul><li><p>Line 1: <code>#!/usr/bin/python</code> -&gt; <code>#!/usr/bin/python3</code></p></li><li><p>Remove importing of <code>six.moves</code> module.</p></li><li><p>Change all instance of <code>xrange</code> to <code>range</code>.</p></li></ul></li></ul><h3><a class="nav-anchor" id="Steps-for-building-slim-1" href="#Steps-for-building-slim-1">Steps for building <code>slim</code></a></h3><ul><li>Put <code>ILSVRC2012_img_train.tar</code> and <code>ILSVRC2012_img_val.tar</code> in a known spot </li></ul><p>(<code>&lt;path/to/imagenet&gt;</code>) with 500GB+ of available memory.</p><p>Navigate in this repository to: <code>/datasets/imagenet/slim</code>. Launch a Tensorflow docker container with</p><pre><code class="language-sh">docker run -it --rm \
    -v &lt;path/to/imagnet&gt;:/imagenet \
    -v $PWD:/slim-builder \
    -e LOCAL_USER_ID=$UID \
    darchr/tf-compiled-base /bin/bash</code></pre><p>inside the docker container, run:</p><pre><code class="language-sh">cd slim-builder
$PWD/download_and_convert_imagenet.sh /imagenet</code></pre><p>When prompted to enter in your credentials, just hit enter. The script won&#39;t download imagenet anyways so it doesn&#39;t matter what you put in.  Hopefully, everything works  as expected. If not, you can always edit the <code>download_and_convert_imagenet.sh</code> file,  commenting out the script/python invokations that have already completed.</p><footer><hr/><a class="previous" href="../../docker/tensorflow/"><span class="direction">Previous</span><span class="title">Tensorflow CPU</span></a><a class="next" href="../fsns/"><span class="direction">Next</span><span class="title">French Street Name Signs (FSNS)</span></a></footer></article></body></html>
